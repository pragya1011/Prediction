# -*- coding: utf-8 -*-
"""Students_Performance.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/17RpWu_7weSpWF34owjnHYdXN7_qLvg99
"""

# Import necessary libraries
import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt

# Load the dataset from a Google Drive link
@st.cache
def load_data():
    # Replace with your public Google Drive link
    gdrive_link = "https://drive.google.com/uc?id=1HnLCBBbmV3MRrSPARsFOx6kZCqpUCPEo"  # Replace FILE_ID with the actual ID
    data = pd.read_csv(gdrive_link)
    # Replace binary values and map grades
    data['Gender'] = data['Gender'].replace({0: "Male", 1: "Female"})
    data['Tutoring'] = data['Tutoring'].replace({0: "No", 1: "Yes"})
    data['Extracurricular'] = data['Extracurricular'].replace({0: "No", 1: "Yes"})
    grade_mapping = {0: "A", 1: "B", 2: "C", 3: "D", 4: "E"}
    data['GradeClass'] = data['GradeClass'].map(grade_mapping)
    return data

student_data = load_data()

# Administrator View
def administrator_view(data):
    st.subheader("Administrator Dashboard")
    total_students = len(data['StudentID'].unique())
    avg_gpa = data['GPA'].mean()
    grade_counts = data['GradeClass'].value_counts()

    st.write(f"**Total Students:** {total_students}")
    st.write(f"**Average GPA:** {avg_gpa:.2f}")
    st.write("**Students by Grade:**")
    st.bar_chart(grade_counts)

# Teacher View
def teacher_view(data):
    st.subheader("Teacher Dashboard")
    student_id = st.selectbox("Select Student ID", data['StudentID'])
    student_details = data[data['StudentID'] == student_id]
    st.write("### Student Details")
    st.dataframe(student_details)

    if st.button("View Graphical Representation"):
        st.write("Graphical Representation of Student Details")

        # Select only numeric data for plotting
        numeric_data = student_details.select_dtypes(include=['number']).drop(columns=['StudentID'], errors='ignore')
        
        # Check if there's numeric data to plot
        if numeric_data.empty:
            st.error("No numeric data available for plotting.")
            return

        # Transpose for better visualization
        numeric_data = numeric_data.T
        numeric_data.columns = ['Value']

        # Plot the data
        fig, ax = plt.subplots()
        numeric_data.plot(kind='bar', legend=False, ax=ax, color='skyblue')
        plt.title(f"Student ID: {student_id} - Numeric Details")
        st.pyplot(fig)

# Student View
def student_view(data):
    st.subheader("Student Dashboard")

    # Select Gender
    gender_map = {0: "Male", 1: "Female"}
    gender_reverse_map = {"Male": 0, "Female": 1}
    gender = st.selectbox("Select Gender", ["Male", "Female"])
    gender_value = gender_reverse_map[gender]

    # Select Age
    age = st.selectbox("Select Age", list(range(15, 19)))  # Allowable range is 15-18
    if age not in data['Age'].unique():
        st.error("Chosen wrong value, kindly choose between 15 and 18")
        return

    # Select Study Time Weekly
    study_time_ranges = {"0-5": (0, 5), "5-10": (5, 10), "10-15": (10, 15), "15-20": (15, 20)}
    study_time = st.selectbox("Select Study Time Weekly", list(study_time_ranges.keys()))
    study_time_min, study_time_max = study_time_ranges[study_time]

    # Select Absences
    absence_ranges = {"0-5": (0, 5), "5-10": (5, 10), "10-15": (10, 15), "15-20": (15, 20), "20-25": (20, 25), "25-30": (25, 30)}
    absences = st.selectbox("Select Absences", list(absence_ranges.keys()))
    absences_min, absences_max = absence_ranges[absences]

    # Select Tutoring
    tutoring_map = {0: "No", 1: "Yes"}
    tutoring_reverse_map = {"No": 0, "Yes": 1}
    tutoring = st.selectbox("Tutoring", ["No", "Yes"])
    tutoring_value = tutoring_reverse_map[tutoring]

    # Select Extracurricular
    extracurricular = st.selectbox("Extracurricular", ["No", "Yes"])
    extracurricular_value = tutoring_reverse_map[extracurricular]

    # Filter data based on user input
    filtered_data = data[
        (data["Gender"] == gender_value) &
        (data["Age"] == age) &
        (data["StudyTimeWeekly"] >= study_time_min) & (data["StudyTimeWeekly"] < study_time_max) &
        (data["Absences"] >= absences_min) & (data["Absences"] < absences_max) &
        (data["Tutoring"] == tutoring_value) &
        (data["Extracurricular"] == extracurricular_value)
    ]

    # Check if any data matches the filters
    if filtered_data.empty:
        st.warning("No students found with the selected criteria.")
        return

    # Predict GPA and Grade
    predicted_gpa = filtered_data['GPA'].mean()
    predicted_grade = filtered_data['GradeClass'].mode()[0]
    grade_map = {0: "A", 1: "B", 2: "C", 3: "D", 4: "E"}

    st.write(f"**Predicted GPA:** {predicted_gpa:.2f}")
    st.write(f"**Predicted Grade Class:** {grade_map[int(predicted_grade)]}")

    # Recommendation based on grade
    recommendation = {
        "A": "Performed good, keep it up.",
        "B": "Working hard, do not stop now.",
        "C": "There are chances of going higher, keep the motivation high.",
        "D": "Can do better, work harder and put more effort.",
        "E": "Needs improvement, focus on the priorities."
    }
    st.write(f"**Recommendation:** {recommendation[grade_map[int(predicted_grade)]]}")
